---
layout: default
---

<div class="api">
    <aside class="sidebar">
        <ul>
                <li {% if page.url == '../classes/AbstractAdapter.html' %} class="active" {% endif %}>
                    <a href="../classes/AbstractAdapter.html">
                        AbstractAdapter
                    </a>
                </li>
                <li {% if page.url == '../classes/AbstractDispatcher.html' %} class="active" {% endif %}>
                    <a href="../classes/AbstractDispatcher.html">
                        AbstractDispatcher
                    </a>
                </li>
                <li {% if page.url == '../classes/Application.html' %} class="active" {% endif %}>
                    <a href="../classes/Application.html">
                        Application
                    </a>
                </li>
                <li {% if page.url == '../classes/CommandBehavior.html' %} class="active" {% endif %}>
                    <a href="../classes/CommandBehavior.html">
                        CommandBehavior
                    </a>
                </li>
                <li {% if page.url == '../classes/CommandChain.html' %} class="active" {% endif %}>
                    <a href="../classes/CommandChain.html">
                        CommandChain
                    </a>
                </li>
                <li {% if page.url == '../classes/CommandContext.html' %} class="active" {% endif %}>
                    <a href="../classes/CommandContext.html">
                        CommandContext
                    </a>
                </li>
                <li {% if page.url == '../classes/Controller.html' %} class="active" {% endif %}>
                    <a href="../classes/Controller.html">
                        Controller
                    </a>
                </li>
                <li {% if page.url == '../classes/ControllerAbstract.html' %} class="active" {% endif %}>
                    <a href="../classes/ControllerAbstract.html">
                        ControllerAbstract
                    </a>
                </li>
                <li {% if page.url == '../classes/DefaultAuthenticator.html' %} class="active" {% endif %}>
                    <a href="../classes/DefaultAuthenticator.html">
                        DefaultAuthenticator
                    </a>
                </li>
                <li {% if page.url == '../classes/Dispatcher.html' %} class="active" {% endif %}>
                    <a href="../classes/Dispatcher.html">
                        Dispatcher
                    </a>
                </li>
                <li {% if page.url == '../classes/Inflector.html' %} class="active" {% endif %}>
                    <a href="../classes/Inflector.html">
                        Inflector
                    </a>
                </li>
                <li {% if page.url == '../classes/Mixin.html' %} class="active" {% endif %}>
                    <a href="../classes/Mixin.html">
                        Mixin
                    </a>
                </li>
                <li {% if page.url == '../classes/Model.html' %} class="active" {% endif %}>
                    <a href="../classes/Model.html">
                        Model
                    </a>
                </li>
                <li {% if page.url == '../classes/ModelAbstract.html' %} class="active" {% endif %}>
                    <a href="../classes/ModelAbstract.html">
                        ModelAbstract
                    </a>
                </li>
                <li {% if page.url == '../classes/MongoAdapter.html' %} class="active" {% endif %}>
                    <a href="../classes/MongoAdapter.html">
                        MongoAdapter
                    </a>
                </li>
                <li {% if page.url == '../classes/MysqlAdapter.html' %} class="active" {% endif %}>
                    <a href="../classes/MysqlAdapter.html">
                        MysqlAdapter
                    </a>
                </li>
                <li {% if page.url == '../classes/ObjectIdentifier.html' %} class="active" {% endif %}>
                    <a href="../classes/ObjectIdentifier.html">
                        ObjectIdentifier
                    </a>
                </li>
                <li {% if page.url == '../classes/ObjectLoader.html' %} class="active" {% endif %}>
                    <a href="../classes/ObjectLoader.html">
                        ObjectLoader
                    </a>
                </li>
                <li {% if page.url == '../classes/ObjectManager.html' %} class="active" {% endif %}>
                    <a href="../classes/ObjectManager.html">
                        ObjectManager
                    </a>
                </li>
                <li {% if page.url == '../classes/Plugin.html' %} class="active" {% endif %}>
                    <a href="../classes/Plugin.html">
                        Plugin
                    </a>
                </li>
                <li {% if page.url == '../classes/RaddishError.html' %} class="active" {% endif %}>
                    <a href="../classes/RaddishError.html">
                        RaddishError
                    </a>
                </li>
                <li {% if page.url == '../classes/Role.html' %} class="active" {% endif %}>
                    <a href="../classes/Role.html">
                        Role
                    </a>
                </li>
                <li {% if page.url == '../classes/Router.html' %} class="active" {% endif %}>
                    <a href="../classes/Router.html">
                        Router
                    </a>
                </li>
                <li {% if page.url == '../classes/Row.html' %} class="active" {% endif %}>
                    <a href="../classes/Row.html">
                        Row
                    </a>
                </li>
                <li {% if page.url == '../classes/RowAbstract.html' %} class="active" {% endif %}>
                    <a href="../classes/RowAbstract.html">
                        RowAbstract
                    </a>
                </li>
                <li {% if page.url == '../classes/Rowset.html' %} class="active" {% endif %}>
                    <a href="../classes/Rowset.html">
                        Rowset
                    </a>
                </li>
                <li {% if page.url == '../classes/RowsetAbstract.html' %} class="active" {% endif %}>
                    <a href="../classes/RowsetAbstract.html">
                        RowsetAbstract
                    </a>
                </li>
                <li {% if page.url == '../classes/Socket.html' %} class="active" {% endif %}>
                    <a href="../classes/Socket.html">
                        Socket
                    </a>
                </li>
                <li {% if page.url == '../classes/SqliteAdapter.html' %} class="active" {% endif %}>
                    <a href="../classes/SqliteAdapter.html">
                        SqliteAdapter
                    </a>
                </li>
                <li {% if page.url == '../classes/States.html' %} class="active" {% endif %}>
                    <a href="../classes/States.html">
                        States
                    </a>
                </li>
                <li {% if page.url == '../classes/Table.html' %} class="active" {% endif %}>
                    <a href="../classes/Table.html">
                        Table
                    </a>
                </li>
                <li {% if page.url == '../classes/ViewAbstract.html' %} class="active" {% endif %}>
                    <a href="../classes/ViewAbstract.html">
                        ViewAbstract
                    </a>
                </li>
                <li {% if page.url == '../classes/ViewJson.html' %} class="active" {% endif %}>
                    <a href="../classes/ViewJson.html">
                        ViewJson
                    </a>
                </li>
        </ul>    </aside>

    <article>
        <h1 class="file-heading">File: lib/database/adapter/sqlite.js</h1>
        
        <div class="file">
            <pre class="code prettyprint linenums">
        var AbstractAdapter = require(&#x27;./abstract&#x27;),
            util            = require(&#x27;util&#x27;),
            sqlite          = require(&#x27;sqlite3&#x27;),
            query           = require(&#x27;universal-query&#x27;),
            instances       = {},
            Filter          = require(&#x27;../../filter/filter&#x27;),
            MysqlAdapter    = require(&#x27;./mysql&#x27;);
        
        /**
         * The SQLite adapter uses a file stored on the server as its database
         * This adapter will create a connection with that file.
         *
         * @class SqliteAdapter
         * @extends AbstractAdapter
         * @param {Object} config This is the config object for the adapter
         * @param {Object} connection The connection to the server
         * @constructor
         */
        function SqliteAdapter(config, connection) {
            AbstractAdapter.call(this, config);
        
            if(connection) {
                this.connection = connection;
            }
        
            this.queryBuilder = query.getType(&#x27;mysql&#x27;);
        }
        
        util.inherits(SqliteAdapter, AbstractAdapter);
        
        SqliteAdapter.prototype.types = MysqlAdapter.prototype.types
        
        /**
         * This method will return an instance of the sqlite database,
         * If there is a problem with the connection an error will be thrown.
         *
         * @method getInstance
         * @param name
         * @param config
         * @returns {Object} A resolved promise with the connection.
         */
        SqliteAdapter.prototype.getInstance = function(name, config) {
            var self = this;
        
            if(instances[name]) {
                return Promise.resolve(instances[name]);
            } else {
                return new Promise(function(resolve, reject) {
                    resolve(new sqlite.Database(config.host + &#x27;/&#x27; + config.database));
                }).then(function(connection) {
        
                    instances[name] = new SqliteAdapter({
                        identifier: self.getIdentifier()
                    }, connection);
        
                    return instances[name];
                }).catch(function(error) {
                    throw new RaddishError(500, error.message);
                });
            }
        };
        
        /**
         * This method will create the schema to use.
         *
         * @method getSchema
         * @param {String} name The name of the table to get the schema from.
         * @returns {Promise} The promise containing the schema.
         */
        SqliteAdapter.prototype.getSchema = function(name) {
            var result  = {};
            var self    = this;
        
            return new Promise(function(resolve, reject) {
                this.connection.all(&#x27;PRAGMA table_info(&#x27; + name + &#x27;)&#x27;, function(err, columns) {
                    if(err) {
                        return reject(err);
                    }
                    
                    return resolve(columns);
                })
            }).each(function(column) {
                result[column.name] = {
                    name: column.name,
                    unique: column.pk,
                    autoinc: column.pk,
                    value: column.dflt_value,
                    type: self.getType(column.type),
                    filter: Filter.getFilter(self.getType(column.type))
                };
            }).then(function(columns) {
                // We only serve the columns on this one.
                return {columns: result};
            }).catch(function(error) {
                throw new RaddishError(500, error.message);
            });
        };
        
        /**
         * This method will execute a query on the server.
         *
         * @method execute
         * @param {Object} query The query object to execute.
         * @returns {Promise} The promise with all the data returned from the server.
         */
        SqliteAdapter.prototype.execute = function(query) {
            var self = this;
        
            if(query.constructor.name == &#x27;InsertQuery&#x27;) {
                return new Promise(function(resolve) {
                    self.connection.run(query.toQuery(), function(err) {
                        if(err) {
                            throw new RaddishError(500, error.message);
                        }
                        
                        resolve({insertId: this.lastID});
                    });
                });
            }
            
            return new Promise(function(resolve, reject) {
                this.connection.all(query.toQuery(), function(err, data) {
                    if(err) {
                        return reject(err);
                    }
                    
                    return resolve(data);
                });
            }).catch(function(error) {
                throw new RaddishError(500, error.message);
            });
        };
        
        SqliteAdapter.prototype.getType = MysqlAdapter.prototype.getType;
        
        module.exports = SqliteAdapter;
            </pre>
        </div>
    </article>
</div>