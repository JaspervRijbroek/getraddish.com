---
layout: default
---

<div class="api">
    <aside class="sidebar">
        <ul>
                <li {% if page.url == '../classes/AbstractAdapter.html' %} class="active" {% endif %}>
                    <a href="../classes/AbstractAdapter.html">
                        AbstractAdapter
                    </a>
                </li>
                <li {% if page.url == '../classes/AbstractDispatcher.html' %} class="active" {% endif %}>
                    <a href="../classes/AbstractDispatcher.html">
                        AbstractDispatcher
                    </a>
                </li>
                <li {% if page.url == '../classes/Application.html' %} class="active" {% endif %}>
                    <a href="../classes/Application.html">
                        Application
                    </a>
                </li>
                <li {% if page.url == '../classes/CommandBehavior.html' %} class="active" {% endif %}>
                    <a href="../classes/CommandBehavior.html">
                        CommandBehavior
                    </a>
                </li>
                <li {% if page.url == '../classes/CommandChain.html' %} class="active" {% endif %}>
                    <a href="../classes/CommandChain.html">
                        CommandChain
                    </a>
                </li>
                <li {% if page.url == '../classes/CommandContext.html' %} class="active" {% endif %}>
                    <a href="../classes/CommandContext.html">
                        CommandContext
                    </a>
                </li>
                <li {% if page.url == '../classes/Controller.html' %} class="active" {% endif %}>
                    <a href="../classes/Controller.html">
                        Controller
                    </a>
                </li>
                <li {% if page.url == '../classes/ControllerAbstract.html' %} class="active" {% endif %}>
                    <a href="../classes/ControllerAbstract.html">
                        ControllerAbstract
                    </a>
                </li>
                <li {% if page.url == '../classes/DefaultAuthenticator.html' %} class="active" {% endif %}>
                    <a href="../classes/DefaultAuthenticator.html">
                        DefaultAuthenticator
                    </a>
                </li>
                <li {% if page.url == '../classes/Dispatcher.html' %} class="active" {% endif %}>
                    <a href="../classes/Dispatcher.html">
                        Dispatcher
                    </a>
                </li>
                <li {% if page.url == '../classes/Inflector.html' %} class="active" {% endif %}>
                    <a href="../classes/Inflector.html">
                        Inflector
                    </a>
                </li>
                <li {% if page.url == '../classes/Mixin.html' %} class="active" {% endif %}>
                    <a href="../classes/Mixin.html">
                        Mixin
                    </a>
                </li>
                <li {% if page.url == '../classes/Model.html' %} class="active" {% endif %}>
                    <a href="../classes/Model.html">
                        Model
                    </a>
                </li>
                <li {% if page.url == '../classes/ModelAbstract.html' %} class="active" {% endif %}>
                    <a href="../classes/ModelAbstract.html">
                        ModelAbstract
                    </a>
                </li>
                <li {% if page.url == '../classes/MongoAdapter.html' %} class="active" {% endif %}>
                    <a href="../classes/MongoAdapter.html">
                        MongoAdapter
                    </a>
                </li>
                <li {% if page.url == '../classes/MysqlAdapter.html' %} class="active" {% endif %}>
                    <a href="../classes/MysqlAdapter.html">
                        MysqlAdapter
                    </a>
                </li>
                <li {% if page.url == '../classes/ObjectIdentifier.html' %} class="active" {% endif %}>
                    <a href="../classes/ObjectIdentifier.html">
                        ObjectIdentifier
                    </a>
                </li>
                <li {% if page.url == '../classes/ObjectLoader.html' %} class="active" {% endif %}>
                    <a href="../classes/ObjectLoader.html">
                        ObjectLoader
                    </a>
                </li>
                <li {% if page.url == '../classes/ObjectManager.html' %} class="active" {% endif %}>
                    <a href="../classes/ObjectManager.html">
                        ObjectManager
                    </a>
                </li>
                <li {% if page.url == '../classes/Plugin.html' %} class="active" {% endif %}>
                    <a href="../classes/Plugin.html">
                        Plugin
                    </a>
                </li>
                <li {% if page.url == '../classes/RaddishError.html' %} class="active" {% endif %}>
                    <a href="../classes/RaddishError.html">
                        RaddishError
                    </a>
                </li>
                <li {% if page.url == '../classes/Role.html' %} class="active" {% endif %}>
                    <a href="../classes/Role.html">
                        Role
                    </a>
                </li>
                <li {% if page.url == '../classes/Router.html' %} class="active" {% endif %}>
                    <a href="../classes/Router.html">
                        Router
                    </a>
                </li>
                <li {% if page.url == '../classes/Row.html' %} class="active" {% endif %}>
                    <a href="../classes/Row.html">
                        Row
                    </a>
                </li>
                <li {% if page.url == '../classes/RowAbstract.html' %} class="active" {% endif %}>
                    <a href="../classes/RowAbstract.html">
                        RowAbstract
                    </a>
                </li>
                <li {% if page.url == '../classes/Rowset.html' %} class="active" {% endif %}>
                    <a href="../classes/Rowset.html">
                        Rowset
                    </a>
                </li>
                <li {% if page.url == '../classes/RowsetAbstract.html' %} class="active" {% endif %}>
                    <a href="../classes/RowsetAbstract.html">
                        RowsetAbstract
                    </a>
                </li>
                <li {% if page.url == '../classes/Socket.html' %} class="active" {% endif %}>
                    <a href="../classes/Socket.html">
                        Socket
                    </a>
                </li>
                <li {% if page.url == '../classes/SqliteAdapter.html' %} class="active" {% endif %}>
                    <a href="../classes/SqliteAdapter.html">
                        SqliteAdapter
                    </a>
                </li>
                <li {% if page.url == '../classes/States.html' %} class="active" {% endif %}>
                    <a href="../classes/States.html">
                        States
                    </a>
                </li>
                <li {% if page.url == '../classes/Table.html' %} class="active" {% endif %}>
                    <a href="../classes/Table.html">
                        Table
                    </a>
                </li>
                <li {% if page.url == '../classes/ViewAbstract.html' %} class="active" {% endif %}>
                    <a href="../classes/ViewAbstract.html">
                        ViewAbstract
                    </a>
                </li>
                <li {% if page.url == '../classes/ViewJson.html' %} class="active" {% endif %}>
                    <a href="../classes/ViewJson.html">
                        ViewJson
                    </a>
                </li>
        </ul>    </aside>

    <article>
        <h1 class="file-heading">File: lib/controller/default.js</h1>
        
        <div class="file">
            <pre class="code prettyprint linenums">
        &quot;use strict&quot;;
        
        var ControllerAbstract  = require(&#x27;./abstract&#x27;),
            util                = require(&#x27;util&#x27;),
            Inflector           = require(&#x27;../inflector/inflector&#x27;);
        
        /**
         * Controller class
         * This is the default called on every request,
         * when overwritten a controller object will inherit from this object or the abstract.
         *
         * @class Controller
         * @extends ControllerAbstract
         * @constructor
         */
        function Controller(config) {
            ControllerAbstract.call(this, config);
        }
        
        util.inherits(Controller, ControllerAbstract);
        
        /**
         * This function will react on a GET request.
         * This function will check if the view is singular if it is than _actionRead is called, else _actionBrowse is called,
         * else the getList function is called.
         *
         * @method _actionGet
         * @param {Object} context Context object with the request data.
         * @returns {Promise} The data of the model.
         */
        Controller.prototype._actionGet = function (context) {
            var self = this;
        
            var method = Inflector.isPlural(self.getRequest().view) ? &#x27;browse&#x27; : &#x27;read&#x27;;
        
            return this.execute(method, context)
                .then(function(data) {
                    return [self.getView(), data];
                })
                .spread(function(view, data) {
                    view.setData(data.result);
                    context.result = view;
                    context.status = 200;
        
                    return context;
                });
        };
        
        /**
         * This action will react on a PUT request,
         * The complete context of this action will be forwarded to _actionPost
         *
         * @method _actionPut
         * @param {CommandContext} context Context object with the request data
         * @returns {Promise} The promise with the context to use afterwards
         * @private
         */
        Controller.prototype._actionPut = function(context) {
            return this.forward(&#x27;post&#x27;, context);
        };
        
        /**
         * This action will react on a PATCH request,
         * The complete context of this action will be forwarded to _actionPost
         *
         * @method _actionPatch
         * @param {CommandContext} context Context object with the request data
         * @returns {Promise} The promise with the context to use afterwards
         * @private
         */
        Controller.prototype._actionPatch = function(context) {
            return this.forward(&#x27;post&#x27;, context);
        };
        
        /**
         * _actionBrowse will return a list of items,
         * after this action has been called it will return the data to _actionGet.
         *
         * @method _actionBrowse
         * @param {CommandContext} context Context object with the request data
         * @returns {Promise} The promise with the context to use afterwards
         * @private
         */
        Controller.prototype._actionBrowse = function(context) {
            return this.getModel()
                .then(function(model) {
                    return model.getList();
                })
                .then(function(data) {
                    context.result = data;
                    context.status = 200;
        
                    return context;
                });
        };
        
        /**
         * _actionBrowse will return a single item,
         * after this action has been called it will return the data to _actionGet.
         *
         * @method _actionRead
         * @param {CommandContext} context Context object with the request data
         * @returns {Promise} The promise with the context to use afterwards
         * @private
         */
        Controller.prototype._actionRead = function(context) {
            return this.getModel()
                .then(function(model) {
                    return model.getItem();
                })
                .then(function(data) {
                    context.result = data;
        
                    return context;
                });
        };
        
        /**
         * This function is called on a POST request,
         * When the state is unique _actionEdit is called else _actionAdd will be called.
         * The returned data for these actions will be handled afterwards.
         *
         * @method _actionPost
         * @param {Object} context Context object with the request data.
         * @returns {Promise} The data of the update/ inserted item.
         */
        Controller.prototype._actionPost = function (context) {
            var self = this;
        
            return this.getModel()
                .then(function (model) {
                    var method = model.states.isUnique() ? &#x27;edit&#x27; : &#x27;add&#x27;;
        
                    return self.execute(method, context);
                })
                .then(function(data) {
                    return [self.getView(), data];
                })
                .spread(function(view, data) {
                    view.setData(data.result);
                    context.result = view;
        
                    return context;
                });
        };
        
        /**
         * _actionAdd will add a new record to the database.
         * After this is done the data is returned to _actionPost.
         *
         * @method _actionAdd
         * @param {CommandContext} context Context object with the request data
         * @returns {Promise} The promise with the context to use afterwards
         * @private
         */
        Controller.prototype._actionAdd = function(context) {
            return this.getModel()
                .then(function(model) {
                    return model.getItem();
                })
                .then(function(row) {
                    return row.setData(context.data.fields);
                })
                .then(function(row) {
                    return row.save();
                })
                .then(function(row) {
                    context.result = row;
                    context.status = 201;
        
                    return context;
                });
        };
        
        /**
         * _actionEdit will update an record in the database.
         * After this is done the data is returned to _actionPost.
         *
         * @method _actionEdit
         * @param {CommandContext} context Context object with the request data
         * @returns {Promise} The promise with the context to use afterwards
         * @private
         */
        Controller.prototype._actionEdit = function(context) {
            var self = this;
        
            return this.getModel()
                .then(function(model) {
                    return model.getItem();
                })
                .then(function(item) {
                    return item;
                })
                .then(function(item) {
                    return item.setData(context.data.fields);
                })
                .then(function(row) {
                    return row.save();
                })
                .then(function(row) {
                    context.result = row;
                    context.status = 205;
        
                    return context;
                });
        };
        
        /**
         * This function is called on a DELETE method,
         * this will remove an item from the database.
         *
         * @method _actionDelete
         * @param {Object} context Context object with the request data.
         * @returns {Promise} The data of the removed item.
         */
        Controller.prototype._actionDelete = function (context) {
            var self = this;
        
            return this.getModel()
                .then(function (model) {
                    return model.getItem();
                })
                .then(function (item) {
                    return item;
                })
                .then(function (item) {
                    return [self.getView(), item.delete()];
                })
                .spread(function (view, data) {
                    view.setData(data);
                    context.result = view;
                    context.status = 204;
        
                    return context;
                });
        };
        
        module.exports = Controller;
            </pre>
        </div>
    </article>
</div>