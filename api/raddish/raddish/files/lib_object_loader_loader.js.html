---
layout: default
---

<div class="api">
    <aside class="sidebar">
        <ul>
                <li {% if page.url == '../classes/AbstractAdapter.html' %} class="active" {% endif %}>
                    <a href="../classes/AbstractAdapter.html">
                        AbstractAdapter
                    </a>
                </li>
                <li {% if page.url == '../classes/AbstractDispatcher.html' %} class="active" {% endif %}>
                    <a href="../classes/AbstractDispatcher.html">
                        AbstractDispatcher
                    </a>
                </li>
                <li {% if page.url == '../classes/Application.html' %} class="active" {% endif %}>
                    <a href="../classes/Application.html">
                        Application
                    </a>
                </li>
                <li {% if page.url == '../classes/CommandBehavior.html' %} class="active" {% endif %}>
                    <a href="../classes/CommandBehavior.html">
                        CommandBehavior
                    </a>
                </li>
                <li {% if page.url == '../classes/CommandChain.html' %} class="active" {% endif %}>
                    <a href="../classes/CommandChain.html">
                        CommandChain
                    </a>
                </li>
                <li {% if page.url == '../classes/CommandContext.html' %} class="active" {% endif %}>
                    <a href="../classes/CommandContext.html">
                        CommandContext
                    </a>
                </li>
                <li {% if page.url == '../classes/Controller.html' %} class="active" {% endif %}>
                    <a href="../classes/Controller.html">
                        Controller
                    </a>
                </li>
                <li {% if page.url == '../classes/ControllerAbstract.html' %} class="active" {% endif %}>
                    <a href="../classes/ControllerAbstract.html">
                        ControllerAbstract
                    </a>
                </li>
                <li {% if page.url == '../classes/DefaultAuthenticator.html' %} class="active" {% endif %}>
                    <a href="../classes/DefaultAuthenticator.html">
                        DefaultAuthenticator
                    </a>
                </li>
                <li {% if page.url == '../classes/Dispatcher.html' %} class="active" {% endif %}>
                    <a href="../classes/Dispatcher.html">
                        Dispatcher
                    </a>
                </li>
                <li {% if page.url == '../classes/Inflector.html' %} class="active" {% endif %}>
                    <a href="../classes/Inflector.html">
                        Inflector
                    </a>
                </li>
                <li {% if page.url == '../classes/Mixin.html' %} class="active" {% endif %}>
                    <a href="../classes/Mixin.html">
                        Mixin
                    </a>
                </li>
                <li {% if page.url == '../classes/Model.html' %} class="active" {% endif %}>
                    <a href="../classes/Model.html">
                        Model
                    </a>
                </li>
                <li {% if page.url == '../classes/ModelAbstract.html' %} class="active" {% endif %}>
                    <a href="../classes/ModelAbstract.html">
                        ModelAbstract
                    </a>
                </li>
                <li {% if page.url == '../classes/MongoAdapter.html' %} class="active" {% endif %}>
                    <a href="../classes/MongoAdapter.html">
                        MongoAdapter
                    </a>
                </li>
                <li {% if page.url == '../classes/MysqlAdapter.html' %} class="active" {% endif %}>
                    <a href="../classes/MysqlAdapter.html">
                        MysqlAdapter
                    </a>
                </li>
                <li {% if page.url == '../classes/ObjectIdentifier.html' %} class="active" {% endif %}>
                    <a href="../classes/ObjectIdentifier.html">
                        ObjectIdentifier
                    </a>
                </li>
                <li {% if page.url == '../classes/ObjectLoader.html' %} class="active" {% endif %}>
                    <a href="../classes/ObjectLoader.html">
                        ObjectLoader
                    </a>
                </li>
                <li {% if page.url == '../classes/ObjectManager.html' %} class="active" {% endif %}>
                    <a href="../classes/ObjectManager.html">
                        ObjectManager
                    </a>
                </li>
                <li {% if page.url == '../classes/Plugin.html' %} class="active" {% endif %}>
                    <a href="../classes/Plugin.html">
                        Plugin
                    </a>
                </li>
                <li {% if page.url == '../classes/RaddishError.html' %} class="active" {% endif %}>
                    <a href="../classes/RaddishError.html">
                        RaddishError
                    </a>
                </li>
                <li {% if page.url == '../classes/Role.html' %} class="active" {% endif %}>
                    <a href="../classes/Role.html">
                        Role
                    </a>
                </li>
                <li {% if page.url == '../classes/Router.html' %} class="active" {% endif %}>
                    <a href="../classes/Router.html">
                        Router
                    </a>
                </li>
                <li {% if page.url == '../classes/Row.html' %} class="active" {% endif %}>
                    <a href="../classes/Row.html">
                        Row
                    </a>
                </li>
                <li {% if page.url == '../classes/RowAbstract.html' %} class="active" {% endif %}>
                    <a href="../classes/RowAbstract.html">
                        RowAbstract
                    </a>
                </li>
                <li {% if page.url == '../classes/Rowset.html' %} class="active" {% endif %}>
                    <a href="../classes/Rowset.html">
                        Rowset
                    </a>
                </li>
                <li {% if page.url == '../classes/RowsetAbstract.html' %} class="active" {% endif %}>
                    <a href="../classes/RowsetAbstract.html">
                        RowsetAbstract
                    </a>
                </li>
                <li {% if page.url == '../classes/Socket.html' %} class="active" {% endif %}>
                    <a href="../classes/Socket.html">
                        Socket
                    </a>
                </li>
                <li {% if page.url == '../classes/SqliteAdapter.html' %} class="active" {% endif %}>
                    <a href="../classes/SqliteAdapter.html">
                        SqliteAdapter
                    </a>
                </li>
                <li {% if page.url == '../classes/States.html' %} class="active" {% endif %}>
                    <a href="../classes/States.html">
                        States
                    </a>
                </li>
                <li {% if page.url == '../classes/Table.html' %} class="active" {% endif %}>
                    <a href="../classes/Table.html">
                        Table
                    </a>
                </li>
                <li {% if page.url == '../classes/ViewAbstract.html' %} class="active" {% endif %}>
                    <a href="../classes/ViewAbstract.html">
                        ViewAbstract
                    </a>
                </li>
                <li {% if page.url == '../classes/ViewJson.html' %} class="active" {% endif %}>
                    <a href="../classes/ViewJson.html">
                        ViewJson
                    </a>
                </li>
        </ul>    </aside>

    <article>
        <h1 class="file-heading">File: lib/object/loader/loader.js</h1>
        
        <div class="file">
            <pre class="code prettyprint linenums">
        &quot;use strict&quot;;
        
        /**
         * This is a complete loader for objects.
         * This will be handeling the identifiers as well.
         */
        
        // The cache placeholder.
        // This is a variable which will be used by all the instances.
        var cache               = {},
            clone               = require(&#x27;clone&#x27;),
            Raddish             = require(&#x27;../../raddish/raddish&#x27;),
            ObjectIdentifier    = require(&#x27;../identifier/identifier&#x27;),
            locators            = {};
        
        /**
         * ObjectLoader object which handles all the loading of the requested objects.
         *
         * @class ObjectLoader
         * @constructor
         */
        function ObjectLoader() {
            this.sequence = undefined;
        }
        
        /**
         * Load a specific object.
         * By default it will be checking in the applications folder.
         *
         * @method resolve
         * @param {String} identifier The identifier of the object which needs to be resolved.
         */
        ObjectLoader.prototype.resolve = function (identifier) {
            var sequence = this.getSequence();
        
            for(var index in sequence) {
                var ident = this.parseSequence(sequence[index], identifier);
        
                var object = this.receive(ident);
                if(object !== false) {
                    return object;
                }
            }
        
            return false;
        };
        
        /**
         * Parse the sequence identifier
         * This will result in a usable identifier
         *
         * @method parseSequence
         * @param {Sring} string The sequence string to parse
         * @param identifier
         * @returns {ObjectIdentifier}
         */
        ObjectLoader.prototype.parseSequence = function(string, identifier) {
            string = string.replace(&#x27;&lt;Type&gt;&#x27;, identifier.getType());
            string = string.replace(&#x27;&lt;App&gt;&#x27;, identifier.getApplication());
            string = string.replace(&#x27;&lt;Package&gt;&#x27;, identifier.getPackage());
            string = string.replace(&#x27;&lt;Path&gt;&#x27;, identifier.getPath().join(&#x27;.&#x27;));
            string = string.replace(&#x27;&lt;Name&gt;&#x27;, identifier.getName());
        
            return new ObjectIdentifier(string);
        };
        
        /**
         * This method will check if there is a custom loader sequence, if not return the default.
         *
         * @method getSequence
         * @returns {Array} The complete sequence
         */
        ObjectLoader.prototype.getSequence = function() {
            if(this.sequence) {
                return this.sequence;
            } else {
                if(Raddish.getConfig(&#x27;loader.sequence&#x27;)) {
                    this.sequence = Raddish.getConfig(&#x27;loader.sequence&#x27;);
                } else {
                    this.sequence = [
                        &#x27;&lt;Type&gt;://&lt;App&gt;/&lt;Package&gt;.&lt;Path&gt;.&lt;Name&gt;&#x27;,
                        &#x27;&lt;Type&gt;://&lt;App&gt;/&lt;Package&gt;.&lt;Path&gt;.default&#x27;,
                        &#x27;&lt;Type&gt;://&lt;App&gt;/default.&lt;Path&gt;.&lt;Name&gt;&#x27;,
                        &#x27;&lt;Type&gt;://&lt;App&gt;/default.&lt;Path&gt;.default&#x27;,
                        &#x27;core:&lt;Package&gt;.&lt;Path&gt;.&lt;Name&gt;&#x27;,
                        &#x27;core:&lt;Package&gt;.&lt;Path&gt;.default&#x27;,
                        &#x27;core:&lt;Path&gt;.&lt;Name&gt;&#x27;,
                        &#x27;core:&lt;Path&gt;.default&#x27;
                    ];
                }
        
                return this.sequence;
            }
        };
        
        /**
         * Receive method will triy to return the requested file.
         *
         * @method receive
         * @param {String} path The path to the filename.
         * @returns {Object|false} Result of the call when the file isn&#x27;t found it will return false.
         */
        ObjectLoader.prototype.receive = function (identifier) {
            return locators[identifier.getType()].locate(identifier);
        };
        
        /**
         * This method will act like the require method, but instead of a path it accepts an identifier.
         *
         * @param {String|ObjectIdentifier} identifier The identifier of the required object
         * @returns {Object} Returns the uninstanciated object.
         */
        ObjectLoader.require = function (identifier) {
            if(typeof identifier === &#x27;string&#x27;) {
                identifier = new ObjectIdentifier(identifier);
            }
        
            return this.prototype.resolve(identifier);
        };
        
        /**
         * Add a locator for a specific type.
         *
         * @param {String} path The path to the locator.
         */
        ObjectLoader.addLocator = function (path) {
            var locator = new (require(path))();
        
            if(!locators[locator._type]) {
                locators[locator._type] = locator;
            }
        };
        
        /**
         * The load method will check if the object has been cached.
         * If this is not the case it will try to resolve the object.
         *
         * When an object has been loaded for the first time it is cached for reuse in a later request.
         *
         * @method load
         * @param {String} identifier The identifier of the object to be loaded
         * @return {Promise} This will hold the uninitialized object.
         */
        ObjectLoader.load = function (identifier, config) {
            var self = this.prototype;
            var orgIdentifier = identifier.clone();
        
            if (cache[orgIdentifier.toString()]) {
                var obj = clone(cache[orgIdentifier.toString()], false, 4);
        
                return Promise.resolve(obj);
            } else {
                return Promise.resolve(self.resolve(identifier))
                    .then(function (Obj) {
                        if(typeof Obj === &#x27;boolean&#x27;) {
                            throw new RaddishError(500, &#x27;Identifier &quot;&#x27; + identifier.toString() + &#x27;&quot; is not a correct resource identifier&#x27;);
                        }
        
                        var obj = new Obj({
                            identifier: orgIdentifier
                        });
        
                        return (typeof obj.initialize === &#x27;function&#x27;) ? obj.initialize(config) : obj;
                    })
                    .then(function(object) {
                        if(object.cache !== false &amp;&amp; Raddish.getConfig(&#x27;cache&#x27;)) {
                            cache[orgIdentifier.toString()] = object;
                        }
        
                        return clone(object, false, 4);
                    });
            }
        };
        
        // When we start the system, we also set the locators.
        ObjectLoader.addLocator(&#x27;../locator/core&#x27;);
        ObjectLoader.addLocator(&#x27;../locator/component&#x27;);
        
        module.exports = ObjectLoader;
            </pre>
        </div>
    </article>
</div>