---
layout: default
---

<div class="api">
    <aside class="sidebar">
        <ul>
                <li {% if page.url == '../classes/AbstractAdapter.html' %} class="active" {% endif %}>
                    <a href="../classes/AbstractAdapter.html">
                        AbstractAdapter
                    </a>
                </li>
                <li {% if page.url == '../classes/AbstractDispatcher.html' %} class="active" {% endif %}>
                    <a href="../classes/AbstractDispatcher.html">
                        AbstractDispatcher
                    </a>
                </li>
                <li {% if page.url == '../classes/Application.html' %} class="active" {% endif %}>
                    <a href="../classes/Application.html">
                        Application
                    </a>
                </li>
                <li {% if page.url == '../classes/CommandBehavior.html' %} class="active" {% endif %}>
                    <a href="../classes/CommandBehavior.html">
                        CommandBehavior
                    </a>
                </li>
                <li {% if page.url == '../classes/CommandChain.html' %} class="active" {% endif %}>
                    <a href="../classes/CommandChain.html">
                        CommandChain
                    </a>
                </li>
                <li {% if page.url == '../classes/CommandContext.html' %} class="active" {% endif %}>
                    <a href="../classes/CommandContext.html">
                        CommandContext
                    </a>
                </li>
                <li {% if page.url == '../classes/Controller.html' %} class="active" {% endif %}>
                    <a href="../classes/Controller.html">
                        Controller
                    </a>
                </li>
                <li {% if page.url == '../classes/ControllerAbstract.html' %} class="active" {% endif %}>
                    <a href="../classes/ControllerAbstract.html">
                        ControllerAbstract
                    </a>
                </li>
                <li {% if page.url == '../classes/DefaultAuthenticator.html' %} class="active" {% endif %}>
                    <a href="../classes/DefaultAuthenticator.html">
                        DefaultAuthenticator
                    </a>
                </li>
                <li {% if page.url == '../classes/Dispatcher.html' %} class="active" {% endif %}>
                    <a href="../classes/Dispatcher.html">
                        Dispatcher
                    </a>
                </li>
                <li {% if page.url == '../classes/Inflector.html' %} class="active" {% endif %}>
                    <a href="../classes/Inflector.html">
                        Inflector
                    </a>
                </li>
                <li {% if page.url == '../classes/Mixin.html' %} class="active" {% endif %}>
                    <a href="../classes/Mixin.html">
                        Mixin
                    </a>
                </li>
                <li {% if page.url == '../classes/Model.html' %} class="active" {% endif %}>
                    <a href="../classes/Model.html">
                        Model
                    </a>
                </li>
                <li {% if page.url == '../classes/ModelAbstract.html' %} class="active" {% endif %}>
                    <a href="../classes/ModelAbstract.html">
                        ModelAbstract
                    </a>
                </li>
                <li {% if page.url == '../classes/MongoAdapter.html' %} class="active" {% endif %}>
                    <a href="../classes/MongoAdapter.html">
                        MongoAdapter
                    </a>
                </li>
                <li {% if page.url == '../classes/MysqlAdapter.html' %} class="active" {% endif %}>
                    <a href="../classes/MysqlAdapter.html">
                        MysqlAdapter
                    </a>
                </li>
                <li {% if page.url == '../classes/ObjectIdentifier.html' %} class="active" {% endif %}>
                    <a href="../classes/ObjectIdentifier.html">
                        ObjectIdentifier
                    </a>
                </li>
                <li {% if page.url == '../classes/ObjectLoader.html' %} class="active" {% endif %}>
                    <a href="../classes/ObjectLoader.html">
                        ObjectLoader
                    </a>
                </li>
                <li {% if page.url == '../classes/ObjectManager.html' %} class="active" {% endif %}>
                    <a href="../classes/ObjectManager.html">
                        ObjectManager
                    </a>
                </li>
                <li {% if page.url == '../classes/Plugin.html' %} class="active" {% endif %}>
                    <a href="../classes/Plugin.html">
                        Plugin
                    </a>
                </li>
                <li {% if page.url == '../classes/RaddishError.html' %} class="active" {% endif %}>
                    <a href="../classes/RaddishError.html">
                        RaddishError
                    </a>
                </li>
                <li {% if page.url == '../classes/Role.html' %} class="active" {% endif %}>
                    <a href="../classes/Role.html">
                        Role
                    </a>
                </li>
                <li {% if page.url == '../classes/Router.html' %} class="active" {% endif %}>
                    <a href="../classes/Router.html">
                        Router
                    </a>
                </li>
                <li {% if page.url == '../classes/Row.html' %} class="active" {% endif %}>
                    <a href="../classes/Row.html">
                        Row
                    </a>
                </li>
                <li {% if page.url == '../classes/RowAbstract.html' %} class="active" {% endif %}>
                    <a href="../classes/RowAbstract.html">
                        RowAbstract
                    </a>
                </li>
                <li {% if page.url == '../classes/Rowset.html' %} class="active" {% endif %}>
                    <a href="../classes/Rowset.html">
                        Rowset
                    </a>
                </li>
                <li {% if page.url == '../classes/RowsetAbstract.html' %} class="active" {% endif %}>
                    <a href="../classes/RowsetAbstract.html">
                        RowsetAbstract
                    </a>
                </li>
                <li {% if page.url == '../classes/Socket.html' %} class="active" {% endif %}>
                    <a href="../classes/Socket.html">
                        Socket
                    </a>
                </li>
                <li {% if page.url == '../classes/SqliteAdapter.html' %} class="active" {% endif %}>
                    <a href="../classes/SqliteAdapter.html">
                        SqliteAdapter
                    </a>
                </li>
                <li {% if page.url == '../classes/States.html' %} class="active" {% endif %}>
                    <a href="../classes/States.html">
                        States
                    </a>
                </li>
                <li {% if page.url == '../classes/Table.html' %} class="active" {% endif %}>
                    <a href="../classes/Table.html">
                        Table
                    </a>
                </li>
                <li {% if page.url == '../classes/ViewAbstract.html' %} class="active" {% endif %}>
                    <a href="../classes/ViewAbstract.html">
                        ViewAbstract
                    </a>
                </li>
                <li {% if page.url == '../classes/ViewJson.html' %} class="active" {% endif %}>
                    <a href="../classes/ViewJson.html">
                        ViewJson
                    </a>
                </li>
        </ul>    </aside>

    <article>
        <h1 class="file-heading">File: lib/plugin/plugin.js</h1>
        
        <div class="file">
            <pre class="code prettyprint linenums">
        var fs          = require(&#x27;fs&#x27;),
            Inflector   = require(&#x27;../inflector/inflector&#x27;),
            plugin;
        
        /**
         * Plugin object which will discover and run specific plugins.
         *
         * @class Plugin
         * @constructor
         */
        function Plugin() {
            this.plugins = [];
        }
        
        /**
         * This function will execute a function in the plugins.
         * This will bind the provided parameters to the function.
         *
         * @method execute
         * @param {String} method The name of the function to execute
         * @return {Object} The plugin object itself, used to run more plugins.
         */
        Plugin.prototype.execute = function(method) {
            var args        = Array.prototype.slice.call(arguments);
            // Shift off the first because that is the method name. We already have that one.
            args.shift();
        
            var functions   = [];
            var self        = this;
            method          = this.getMethod(method);
        
            // TODO: This part should be refactored to the #each() method of bluebird.
            return Promise.all(self.plugins)
                .then(function(plugins) {
                    for(var index in plugins) {
                        plugin = plugins[index];
        
                        if(typeof plugin[method] === &#x27;function&#x27;) {
                            functions.push(
                                Promise.cast(
                                    plugin[method].apply(this, args)
                                )
                            );
                        }
                    }
        
                    return Promise.all(functions);
                })
                .then(function() {
                    return self;
                })
                .catch(function() {
                    return self;
                });
        };
        
        
        
        /**
         * This method will get the requested plugin(s).
         * The plugins are for a global system. Because the affect system behaviors.
         *
         * When the type has a &quot;.&quot; in the name it is split.
         * First we will check if the single plugin exists which is path ( + name ) + name.
         * if this file doesn&#x27;t exist then we will check all the files in the directory. (if it is a directory).
         *
         * then we will return everything (file or array).
         * Everything will be cast to a promise.
         *
         * @method get
         * @param {String} type The type of plugins to receive.
         * @returns {Array}
         */
        Plugin.prototype.get = function(type) {
            var path    = [];
            var name    = &#x27;&#x27;;
            var self    = this;
        
            // If there is a dot in the type, I have to check if there is a file located with the last part of the type.
            // If there isn&#x27;t we have subdirectories. And we will return everything.
            // This will rely on fs and require.
            if(type.indexOf(&#x27;.&#x27;) &gt; -1) {
                path = type.split(&#x27;.&#x27;);
                name = path.pop();
            } else {
                name = type;
            }
        
            var dir = process.cwd() + Raddish.getConfig(&#x27;plugins&#x27;) + &#x27;/&#x27;;
            if(path.length &gt; 0) {
                dir += path.join(&#x27;/&#x27;) + &#x27;/&#x27;;
            }
            dir += name;
        
            // TODO: This part has to be refactored.
        
            return Promise.cast(fs.existsSync(dir + &#x27;/&#x27; + name + &#x27;.js&#x27;))
                .then(function(exists) {
                    if(exists) {
                        var Obj = require(dir + &#x27;/&#x27; + name);
                        self.plugins.push(new Obj());
        
                        return self.plugins;
                    } else {
                        return fs.existsSync(dir + &#x27;.js&#x27;);
                    }
                })
                .then(function(exists) {
                    if(exists === true) {
                        var Obj = require(dir);
                        self.plugins.push(new Obj());
        
                        return self.plugins;
                    } else if(typeof exists.push == &#x27;function&#x27;) {
                        return exists;
                    } else {
                        if(fs.existsSync(dir)) {
                            return fs.readdirSync(dir);
                        } else {
                            return false;
                        }
                    }
                })
                .then(function(files) {
                    if(typeof files[0] != &#x27;string&#x27;) {
                        return files;
                    }
        
                    for(var index in files) {
                        var name = files[index];
                        var file = fs.statSync(dir + &#x27;/&#x27; + files[index]);
        
                        if(!file.isDirectory() &amp;&amp; fs.existsSync(dir + &#x27;/&#x27; + name)) {
                            var Obj = require(dir + &#x27;/&#x27; + name);
                            self.plugins.push(new Obj());
                        }
                    }
        
                    return self.plugins;
                })
                .then(function() {
                    return self;
                })
                .catch(function(error) {
                    return self;
                });
        };
        
        /**
         * This method converts the dot-separated method name to a camelcased method
         *
         * @param {String} method The dot-separated method name
         * @returns {string} The camelcased method name.
         */
        Plugin.prototype.getMethod = function(method) {
            var parts = method.split(&#x27;.&#x27;);
            parts = parts.map(function(value) {
                return Inflector.capitalize(value.toLowerCase());
            });
        
            return &#x27;on&#x27; + parts.join(&#x27;&#x27;);
        };
        
        module.exports = Plugin;
            </pre>
        </div>
    </article>
</div>