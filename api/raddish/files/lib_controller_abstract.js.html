---
layout: default
---

<div class="api">
    <aside class="sidebar">
        <ul>
                <li {% if page.url == '../classes/AbstractAdapter.html' %} class="active" {% endif %}>
                    <a href="../classes/AbstractAdapter.html">
                        AbstractAdapter
                    </a>
                </li>
                <li {% if page.url == '../classes/AbstractDispatcher.html' %} class="active" {% endif %}>
                    <a href="../classes/AbstractDispatcher.html">
                        AbstractDispatcher
                    </a>
                </li>
                <li {% if page.url == '../classes/Application.html' %} class="active" {% endif %}>
                    <a href="../classes/Application.html">
                        Application
                    </a>
                </li>
                <li {% if page.url == '../classes/CommandBehavior.html' %} class="active" {% endif %}>
                    <a href="../classes/CommandBehavior.html">
                        CommandBehavior
                    </a>
                </li>
                <li {% if page.url == '../classes/CommandChain.html' %} class="active" {% endif %}>
                    <a href="../classes/CommandChain.html">
                        CommandChain
                    </a>
                </li>
                <li {% if page.url == '../classes/CommandContext.html' %} class="active" {% endif %}>
                    <a href="../classes/CommandContext.html">
                        CommandContext
                    </a>
                </li>
                <li {% if page.url == '../classes/Controller.html' %} class="active" {% endif %}>
                    <a href="../classes/Controller.html">
                        Controller
                    </a>
                </li>
                <li {% if page.url == '../classes/ControllerAbstract.html' %} class="active" {% endif %}>
                    <a href="../classes/ControllerAbstract.html">
                        ControllerAbstract
                    </a>
                </li>
                <li {% if page.url == '../classes/DefaultAuthenticator.html' %} class="active" {% endif %}>
                    <a href="../classes/DefaultAuthenticator.html">
                        DefaultAuthenticator
                    </a>
                </li>
                <li {% if page.url == '../classes/Dispatcher.html' %} class="active" {% endif %}>
                    <a href="../classes/Dispatcher.html">
                        Dispatcher
                    </a>
                </li>
                <li {% if page.url == '../classes/Inflector.html' %} class="active" {% endif %}>
                    <a href="../classes/Inflector.html">
                        Inflector
                    </a>
                </li>
                <li {% if page.url == '../classes/Mixin.html' %} class="active" {% endif %}>
                    <a href="../classes/Mixin.html">
                        Mixin
                    </a>
                </li>
                <li {% if page.url == '../classes/Model.html' %} class="active" {% endif %}>
                    <a href="../classes/Model.html">
                        Model
                    </a>
                </li>
                <li {% if page.url == '../classes/ModelAbstract.html' %} class="active" {% endif %}>
                    <a href="../classes/ModelAbstract.html">
                        ModelAbstract
                    </a>
                </li>
                <li {% if page.url == '../classes/MongoAdapter.html' %} class="active" {% endif %}>
                    <a href="../classes/MongoAdapter.html">
                        MongoAdapter
                    </a>
                </li>
                <li {% if page.url == '../classes/MysqlAdapter.html' %} class="active" {% endif %}>
                    <a href="../classes/MysqlAdapter.html">
                        MysqlAdapter
                    </a>
                </li>
                <li {% if page.url == '../classes/ObjectIdentifier.html' %} class="active" {% endif %}>
                    <a href="../classes/ObjectIdentifier.html">
                        ObjectIdentifier
                    </a>
                </li>
                <li {% if page.url == '../classes/ObjectLoader.html' %} class="active" {% endif %}>
                    <a href="../classes/ObjectLoader.html">
                        ObjectLoader
                    </a>
                </li>
                <li {% if page.url == '../classes/ObjectManager.html' %} class="active" {% endif %}>
                    <a href="../classes/ObjectManager.html">
                        ObjectManager
                    </a>
                </li>
                <li {% if page.url == '../classes/Plugin.html' %} class="active" {% endif %}>
                    <a href="../classes/Plugin.html">
                        Plugin
                    </a>
                </li>
                <li {% if page.url == '../classes/RaddishError.html' %} class="active" {% endif %}>
                    <a href="../classes/RaddishError.html">
                        RaddishError
                    </a>
                </li>
                <li {% if page.url == '../classes/Role.html' %} class="active" {% endif %}>
                    <a href="../classes/Role.html">
                        Role
                    </a>
                </li>
                <li {% if page.url == '../classes/Router.html' %} class="active" {% endif %}>
                    <a href="../classes/Router.html">
                        Router
                    </a>
                </li>
                <li {% if page.url == '../classes/Row.html' %} class="active" {% endif %}>
                    <a href="../classes/Row.html">
                        Row
                    </a>
                </li>
                <li {% if page.url == '../classes/RowAbstract.html' %} class="active" {% endif %}>
                    <a href="../classes/RowAbstract.html">
                        RowAbstract
                    </a>
                </li>
                <li {% if page.url == '../classes/Rowset.html' %} class="active" {% endif %}>
                    <a href="../classes/Rowset.html">
                        Rowset
                    </a>
                </li>
                <li {% if page.url == '../classes/RowsetAbstract.html' %} class="active" {% endif %}>
                    <a href="../classes/RowsetAbstract.html">
                        RowsetAbstract
                    </a>
                </li>
                <li {% if page.url == '../classes/Socket.html' %} class="active" {% endif %}>
                    <a href="../classes/Socket.html">
                        Socket
                    </a>
                </li>
                <li {% if page.url == '../classes/SqliteAdapter.html' %} class="active" {% endif %}>
                    <a href="../classes/SqliteAdapter.html">
                        SqliteAdapter
                    </a>
                </li>
                <li {% if page.url == '../classes/States.html' %} class="active" {% endif %}>
                    <a href="../classes/States.html">
                        States
                    </a>
                </li>
                <li {% if page.url == '../classes/Table.html' %} class="active" {% endif %}>
                    <a href="../classes/Table.html">
                        Table
                    </a>
                </li>
                <li {% if page.url == '../classes/ViewAbstract.html' %} class="active" {% endif %}>
                    <a href="../classes/ViewAbstract.html">
                        ViewAbstract
                    </a>
                </li>
                <li {% if page.url == '../classes/ViewJson.html' %} class="active" {% endif %}>
                    <a href="../classes/ViewJson.html">
                        ViewJson
                    </a>
                </li>
        </ul>    </aside>

    <article>
        <h1 class="file-heading">File: lib/controller/abstract.js</h1>
        
        <div class="file">
            <pre class="code prettyprint linenums">
        &quot;use strict&quot;;
        
        var ObjectManager   = require(&#x27;../object/manager&#x27;),
            util            = require(&#x27;util&#x27;),
            Inflector       = require(&#x27;../inflector/inflector&#x27;),
            CommandContext  = require(&#x27;../command/context/context&#x27;);
        
        /**
         * This class holds all the basic function calls from the controller.
         *
         * @class ControllerAbstract
         * @extends ObjectManager
         * @constructor
         */
        function ControllerAbstract(config) {
            this.model = undefined;
            this.request = {};
            this.format = &#x27;&#x27;;
            this.context = new CommandContext();
        
            ObjectManager.call(this, config);
        }
        
        util.inherits(ControllerAbstract, ObjectManager);
        
        /**
         * This function will initialize the controller,
         * it will set the request and response got from the dispatcher.
         *
         * @method initialize
         * @param {Object|null} config Config object for extra configuration.
         * @returns {Promise} The initialized controller object.
         */
        ControllerAbstract.prototype.initialize = function (config) {
            var extra = this.getComponentConfig(&#x27;controller.&#x27; + this.getIdentifier().getName());
        
            if(!config.behaviors &amp;&amp; !extra.behaviors) {
                config.behaviors = {};
            } else if(!config.behaviors &amp;&amp; extra.behaviors) {
                config.behaviors = extra.behaviors;
            }
        
            if(config.model || extra.model) {
                this.model = extra.model || config.model;
            }
        
            return ControllerAbstract.super_.prototype.initialize.call(this, config);
        };
        
        /**
         * Execute function will execute a command given the method.
         * This command will use the context for the behaviors.
         *
         * @method execute
         * @param {String} method Name of the action to execute.
         * @param {Object} context Data got from the request.
         */
        ControllerAbstract.prototype.execute = function (method, context) {
            var self = this,
                chain = this.getCommandChain();
            method = method.toLowerCase();
        
            return self.getPermissions()
                .then(function(permissions) {
                    return permissions[&#x27;can&#x27; + Inflector.capitalize(method)](context);
                })
                .then(function(may) {
                    if(!may) {
                        throw new RaddishError(401, &#x27;You don\&#x27;t have permission to do this.&#x27;);
                    } else {
                        return chain.run(&#x27;initialize.&#x27; + method, context);
                    }
                })
                .then(function(context) {
                    return chain.run(&#x27;before.&#x27; + method, context);
                })
                .then(function(context) {
                    return self[&#x27;_action&#x27; + Inflector.capitalize(method.toLowerCase())](context);
                })
                .then(function(context) {
                    return chain.run(&#x27;after.&#x27; + method, context);
                })
                .then(function(context) {
                    context.clearRoles();
        
                    return context;
                });
        };
        
        /**
         * The forward method forwards the complete context to another action.
         * THis will return the promise for that specific action.
         *
         * @method forward
         * @param {String} method The method to forward to.
         * @param {Object} context The context specified for that method.
         * @returns {Promise} The promise for the specified method.
         */
        ControllerAbstract.prototype.forward = function(method, context) {
            return this.execute(method, context);
        };
        
        /**
         * This function returns the model matching the controller name.
         * Also this method will automatically set the states.
         *
         * @method getModel
         * @returns {Promise} The initialized model object with set states
         */
        ControllerAbstract.prototype.getModel = function () {
            var model = this.model || this.getIdentifier().clone().setPath([&#x27;model&#x27;]);
            var self = this;
        
            return self.getObject(model, null)
                .then(function (model) {
                    return model.set(self.getRequest());
                });
        };
        
        /**
         * This function will return the context of the current controller.
         *
         * @method getContext
         * @returns {Object} Context object.
         */
        ControllerAbstract.prototype.getContext = function() {
            return this.context;
        };
        
        /**
         * This function returns the complete request.
         *
         * @method getRequest
         * @returns {Object} The states in the request
         */
        ControllerAbstract.prototype.getRequest = function() {
            return this.request;
        };
        
        /**
         * This function will return the initialize view matching the layout given in the request or on the default
         *
         * @method getView
         * @returns {Promise} The initialized view object
         */
        ControllerAbstract.prototype.getView = function () {
            var identifier = this.getIdentifier().clone();
            var self = this;
        
            return this.getModel()
                .then(function(model) {
                    return [self.getObject(identifier.setPath([&#x27;view&#x27;]).setName(self.format)), model];
                })
                .spread(function(view, model) {
                    view.model = model;
                    view.request = self.getRequest();
        
                    return view;
                });
        };
        
        /**
         * This function returns the permission set of the current controller.
         * This function has not been implemented as of yet.
         *
         * @method getPermissions
         * @returns {Promise} The complete permissions set
         */
        ControllerAbstract.prototype.getPermissions = function () {
            var identifier = this.getIdentifier().clone();
        
            return this.getObject(identifier.setPath([&#x27;controller&#x27;, &#x27;permission&#x27;]));
        };
        
        module.exports = ControllerAbstract;
            </pre>
        </div>
    </article>
</div>