---
title: lib/plugin/plugin.js - Raddish API
category: api
layout: default
---

<div class="row">
    <div class="col-md-3">
        <h1>Classes</h1>
        
        <ul class="nav nav-pills nav-stacked">
                <li {% if page.url == '/docs/classes/AbstractAdapter.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/AbstractAdapter.html">AbstractAdapter</a>
                </li>
                <li {% if page.url == '/docs/classes/AbstractDispatcher.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/AbstractDispatcher.html">AbstractDispatcher</a>
                </li>
                <li {% if page.url == '/docs/classes/Application.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/Application.html">Application</a>
                </li>
                <li {% if page.url == '/docs/classes/CommandBehavior.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/CommandBehavior.html">CommandBehavior</a>
                </li>
                <li {% if page.url == '/docs/classes/CommandChain.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/CommandChain.html">CommandChain</a>
                </li>
                <li {% if page.url == '/docs/classes/CommandContext.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/CommandContext.html">CommandContext</a>
                </li>
                <li {% if page.url == '/docs/classes/Controller.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/Controller.html">Controller</a>
                </li>
                <li {% if page.url == '/docs/classes/ControllerAbstract.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/ControllerAbstract.html">ControllerAbstract</a>
                </li>
                <li {% if page.url == '/docs/classes/DefaultAuthenticator.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/DefaultAuthenticator.html">DefaultAuthenticator</a>
                </li>
                <li {% if page.url == '/docs/classes/Dispatcher.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/Dispatcher.html">Dispatcher</a>
                </li>
                <li {% if page.url == '/docs/classes/Inflector.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/Inflector.html">Inflector</a>
                </li>
                <li {% if page.url == '/docs/classes/Mixin.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/Mixin.html">Mixin</a>
                </li>
                <li {% if page.url == '/docs/classes/Model.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/Model.html">Model</a>
                </li>
                <li {% if page.url == '/docs/classes/ModelAbstract.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/ModelAbstract.html">ModelAbstract</a>
                </li>
                <li {% if page.url == '/docs/classes/MongoAdapter.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/MongoAdapter.html">MongoAdapter</a>
                </li>
                <li {% if page.url == '/docs/classes/MysqlAdapter.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/MysqlAdapter.html">MysqlAdapter</a>
                </li>
                <li {% if page.url == '/docs/classes/ObjectIdentifier.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/ObjectIdentifier.html">ObjectIdentifier</a>
                </li>
                <li {% if page.url == '/docs/classes/ObjectLoader.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/ObjectLoader.html">ObjectLoader</a>
                </li>
                <li {% if page.url == '/docs/classes/ObjectManager.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/ObjectManager.html">ObjectManager</a>
                </li>
                <li {% if page.url == '/docs/classes/Plugin.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/Plugin.html">Plugin</a>
                </li>
                <li {% if page.url == '/docs/classes/RaddishError.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/RaddishError.html">RaddishError</a>
                </li>
                <li {% if page.url == '/docs/classes/Role.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/Role.html">Role</a>
                </li>
                <li {% if page.url == '/docs/classes/Router.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/Router.html">Router</a>
                </li>
                <li {% if page.url == '/docs/classes/Row.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/Row.html">Row</a>
                </li>
                <li {% if page.url == '/docs/classes/RowAbstract.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/RowAbstract.html">RowAbstract</a>
                </li>
                <li {% if page.url == '/docs/classes/Rowset.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/Rowset.html">Rowset</a>
                </li>
                <li {% if page.url == '/docs/classes/RowsetAbstract.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/RowsetAbstract.html">RowsetAbstract</a>
                </li>
                <li {% if page.url == '/docs/classes/Socket.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/Socket.html">Socket</a>
                </li>
                <li {% if page.url == '/docs/classes/SqliteAdapter.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/SqliteAdapter.html">SqliteAdapter</a>
                </li>
                <li {% if page.url == '/docs/classes/States.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/States.html">States</a>
                </li>
                <li {% if page.url == '/docs/classes/Table.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/Table.html">Table</a>
                </li>
                <li {% if page.url == '/docs/classes/ViewAbstract.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/ViewAbstract.html">ViewAbstract</a>
                </li>
                <li {% if page.url == '/docs/classes/ViewJson.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/ViewJson.html">ViewJson</a>
                </li>
        </ul>    </div>
    <div class="col-md-9">
        <h1>File: lib/plugin/plugin.js</h1>
        
        
        {% highlight javascript linenos %}
        var fs          = Promise.promisifyAll(require('fs'));
        var Inflector   = require('../inflector/inflector');
        
        /**
         * Plugin object which will discover and run specific plugins.
         *
         * @class Plugin
         * @constructor
         */
        function Plugin() {
            this.plugins = [];
        }
        
        /**
         * This function will execute a function in the plugins.
         * This will bind the provided parameters to the function.
         *
         * @method execute
         * @param {String} method The name of the function to execute
         * @return {Object} The plugin object itself, used to run more plugins.
         */
        Plugin.prototype.execute = function(method) {
            var args        = Array.prototype.slice.call(arguments);
            // Shift off the first because that is the method name. We already have that one.
            args.shift();
        
            var functions   = [];
            var self        = this;
            method          = this.getMethod(method);
        
            // TODO: This part should be refactored to the #each() method of bluebird.
            return Promise.all(self.plugins)
                .then(function(plugins) {
                    for(var index in plugins) {
                        var plugin = plugins[index];
        
                        if(typeof plugin[method] === 'function') {
                            functions.push(
                                Promise.cast(
                                    plugin[method].apply(this, args)
                                )
                            );
                        }
                    }
        
                    return Promise.all(functions);
                })
                .then(function() {
                    return self;
                })
                .catch(function() {
                    return self;
                });
        };
        
        
        
        /**
         * This method will get the requested plugin(s).
         * The plugins are for a global system. Because the affect system behaviors.
         *
         * When the type has a "." in the name it is split.
         * First we will check if the single plugin exists which is path ( + name ) + name.
         * if this file doesn't exist then we will check all the files in the directory. (if it is a directory).
         *
         * then we will return everything (file or array).
         * Everything will be cast to a promise.
         *
         * @method get
         * @param {String} type The type of plugins to receive.
         * @returns {Array}
         */
        Plugin.prototype.get = function(type) {
            var path    = [];
            var name    = '';
            var self    = this;
        
            // If there is a dot in the type, I have to check if there is a file located with the last part of the type.
            // If there isn't we have subdirectories. And we will return everything.
            // This will rely on fs and require.
            if(type.indexOf('.') > -1) {
                path = type.split('.');
                name = path.pop();
            } else {
                name = type;
            }
        
            var dir = process.cwd() + Raddish.getConfig('plugins') + '/';
            if(path.length > 0) {
                dir += path.join('/') + '/';
            }
            dir += name;
        
            // TODO: This part has to be refactored.
        
            return Promise.cast(fs.existsSync(dir + '/' + name + '.js'))
                .then(function(exists) {
                    if(exists) {
                        var Obj = require(dir + '/' + name);
                        self.plugins.push(new Obj());
        
                        return self.plugins;
                    } else {
                        return fs.existsSync(dir + '.js');
                    }
                })
                .then(function(exists) {
                    if(exists === true) {
                        var Obj = require(dir);
                        self.plugins.push(new Obj());
        
                        return self.plugins;
                    } else if(typeof exists.push == 'function') {
                        return exists;
                    } else {
                        if(fs.existsSync(dir)) {
                            return fs.readdirAsync(dir);
                        } else {
                            return false;
                        }
                    }
                })
                .then(function(files) {
                    if(typeof files[0] != 'string') {
                        return files;
                    }
        
                    for(var index in files) {
                        var name = files[index];
                        var file = fs.statSync(dir + '/' + files[index]);
        
                        if(!file.isDirectory() && fs.existsSync(dir + '/' + name)) {
                            var Obj = require(dir + '/' + name);
                            self.plugins.push(new Obj());
                        }
                    }
        
                    return self.plugins;
                })
                .then(function() {
                    return self;
                })
                .catch(function(error) {
                    console.log(error);
        
                    return self;
                });
        };
        
        /**
         * This method converts the dot-separated method name to a camelcased method
         *
         * @param {String} method The dot-separated method name
         * @returns {string} The camelcased method name.
         */
        Plugin.prototype.getMethod = function(method) {
            var parts = method.split('.');
            parts = parts.map(function(value) {
                return Inflector.capitalize(value.toLowerCase());
            });
        
            return 'on' + parts.join('');
        };
        
        module.exports = Plugin;
        {% endhighlight %}    </div>
</div>