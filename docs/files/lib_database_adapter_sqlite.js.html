---
title: lib/database/adapter/sqlite.js - Raddish API
category: api
layout: default
---

<div class="row">
    <div class="col-md-3">
        <h1>Classes</h1>
        
        <ul class="nav nav-pills nav-stacked">
                <li {% if page.url == '/docs/classes/AbstractAdapter.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/AbstractAdapter.html">AbstractAdapter</a>
                </li>
                <li {% if page.url == '/docs/classes/AbstractDispatcher.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/AbstractDispatcher.html">AbstractDispatcher</a>
                </li>
                <li {% if page.url == '/docs/classes/Application.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/Application.html">Application</a>
                </li>
                <li {% if page.url == '/docs/classes/CommandBehavior.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/CommandBehavior.html">CommandBehavior</a>
                </li>
                <li {% if page.url == '/docs/classes/CommandChain.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/CommandChain.html">CommandChain</a>
                </li>
                <li {% if page.url == '/docs/classes/CommandContext.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/CommandContext.html">CommandContext</a>
                </li>
                <li {% if page.url == '/docs/classes/Controller.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/Controller.html">Controller</a>
                </li>
                <li {% if page.url == '/docs/classes/ControllerAbstract.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/ControllerAbstract.html">ControllerAbstract</a>
                </li>
                <li {% if page.url == '/docs/classes/DefaultAuthenticator.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/DefaultAuthenticator.html">DefaultAuthenticator</a>
                </li>
                <li {% if page.url == '/docs/classes/Dispatcher.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/Dispatcher.html">Dispatcher</a>
                </li>
                <li {% if page.url == '/docs/classes/Inflector.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/Inflector.html">Inflector</a>
                </li>
                <li {% if page.url == '/docs/classes/Mixin.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/Mixin.html">Mixin</a>
                </li>
                <li {% if page.url == '/docs/classes/Model.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/Model.html">Model</a>
                </li>
                <li {% if page.url == '/docs/classes/ModelAbstract.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/ModelAbstract.html">ModelAbstract</a>
                </li>
                <li {% if page.url == '/docs/classes/MongoAdapter.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/MongoAdapter.html">MongoAdapter</a>
                </li>
                <li {% if page.url == '/docs/classes/MysqlAdapter.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/MysqlAdapter.html">MysqlAdapter</a>
                </li>
                <li {% if page.url == '/docs/classes/ObjectIdentifier.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/ObjectIdentifier.html">ObjectIdentifier</a>
                </li>
                <li {% if page.url == '/docs/classes/ObjectLoader.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/ObjectLoader.html">ObjectLoader</a>
                </li>
                <li {% if page.url == '/docs/classes/ObjectManager.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/ObjectManager.html">ObjectManager</a>
                </li>
                <li {% if page.url == '/docs/classes/Plugin.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/Plugin.html">Plugin</a>
                </li>
                <li {% if page.url == '/docs/classes/RaddishError.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/RaddishError.html">RaddishError</a>
                </li>
                <li {% if page.url == '/docs/classes/Role.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/Role.html">Role</a>
                </li>
                <li {% if page.url == '/docs/classes/Router.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/Router.html">Router</a>
                </li>
                <li {% if page.url == '/docs/classes/Row.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/Row.html">Row</a>
                </li>
                <li {% if page.url == '/docs/classes/RowAbstract.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/RowAbstract.html">RowAbstract</a>
                </li>
                <li {% if page.url == '/docs/classes/Rowset.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/Rowset.html">Rowset</a>
                </li>
                <li {% if page.url == '/docs/classes/RowsetAbstract.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/RowsetAbstract.html">RowsetAbstract</a>
                </li>
                <li {% if page.url == '/docs/classes/Socket.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/Socket.html">Socket</a>
                </li>
                <li {% if page.url == '/docs/classes/SqliteAdapter.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/SqliteAdapter.html">SqliteAdapter</a>
                </li>
                <li {% if page.url == '/docs/classes/States.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/States.html">States</a>
                </li>
                <li {% if page.url == '/docs/classes/Table.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/Table.html">Table</a>
                </li>
                <li {% if page.url == '/docs/classes/ViewAbstract.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/ViewAbstract.html">ViewAbstract</a>
                </li>
                <li {% if page.url == '/docs/classes/ViewJson.html' %} class="active" {% endif %}>
                    <a href="/docs/classes/ViewJson.html">ViewJson</a>
                </li>
        </ul>    </div>
    <div class="col-md-9">
        <h1>File: lib/database/adapter/sqlite.js</h1>
        
        
        {% highlight javascript linenos %}
        var AbstractAdapter = require('./abstract');
        var util            = require('util');
        var sqlite          = require('sqlite3');
        var query           = require('universal-query');
        var instances       = {};
        var Filter          = require('../../filter/filter');
        var MysqlAdapter    = require('./mysql');
        
        /**
         * The SQLite adapter uses a file stored on the server as its database
         * This adapter will create a connection with that file.
         *
         * @class SqliteAdapter
         * @extends AbstractAdapter
         * @param {Object} config This is the config object for the adapter
         * @param {Object} connection The connection to the server
         * @constructor
         */
        function SqliteAdapter(config, connection) {
            AbstractAdapter.call(this, config);
        
            if(connection) {
                this.connection = Promise.promisifyAll(connection);
            }
        
            this.queryBuilder = query.getType('mysql');
        }
        
        util.inherits(SqliteAdapter, AbstractAdapter);
        
        SqliteAdapter.prototype.types = MysqlAdapter.prototype.types
        
        /**
         * This method will return an instance of the sqlite database,
         * If there is a problem with the connection an error will be thrown.
         *
         * @method getInstance
         * @param name
         * @param config
         * @returns {Object} A resolved promise with the connection.
         */
        SqliteAdapter.prototype.getInstance = function(name, config) {
            var self = this;
        
            if(instances[name]) {
                return Promise.resolve(instances[name]);
            } else {
                return new Promise(function(resolve, reject) {
                    resolve(new sqlite.Database(config.host + '/' + config.database));
                }).then(function(connection) {
        
                    instances[name] = new SqliteAdapter({
                        identifier: self.getIdentifier()
                    }, connection);
        
                    return instances[name];
                }).catch(function(error) {
                    throw new RaddishError(500, error.message);
                });
            }
        };
        
        /**
         * This method will create the schema to use.
         *
         * @method getSchema
         * @param {String} name The name of the table to get the schema from.
         * @returns {Promise} The promise containing the schema.
         */
        SqliteAdapter.prototype.getSchema = function(name) {
            var result  = {};
            var self    = this;
        
            return this.connection.allAsync('PRAGMA table_info(' + name + ')')
                .each(function(column) {
                    result[column.name] = {
                        name: column.name,
                        unique: column.pk,
                        autoinc: column.pk,
                        value: column.dflt_value,
                        type: self.getType(column.type),
                        filter: Filter.getFilter(self.getType(column.type))
                    };
                })
                .then(function(columns) {
                    // We only serve the columns on this one.
                    return {columns: result};
                })
                .catch(function(error) {
                    throw new RaddishError(500, error.message);
                });
        };
        
        /**
         * This method will execute a query on the server.
         *
         * @method execute
         * @param {Object} query The query object to execute.
         * @returns {Promise} The promise with all the data returned from the server.
         */
        SqliteAdapter.prototype.execute = function(query) {
            return this.connection.allAsync(query.toQuery())
                .then(function(data) {
                    return data;
                })
                .catch(function(error) {
                    throw new RaddishError(500, error.message);
                });
        };
        
        SqliteAdapter.prototype.getType = MysqlAdapter.prototype.getType;
        
        module.exports = SqliteAdapter;
        {% endhighlight %}    </div>
</div>